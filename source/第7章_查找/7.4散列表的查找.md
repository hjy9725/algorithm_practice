### 7.4.2 散列函数的构造方法

构造散列函数的方法很多，一般来说，应根据具体问题选用不同的散列函数，通常要考虑以下因素：

1. 散列表的长度；
2. 关键字的长度；
3. 关键字的分布情况；
4. 计算散列函数所需的时间；
5. 记录的查找频率。

构造一个“好”的散列函数应遵循以下两条原则：
1. 函数计算要简单，每一关键字只能有一个散列地址与之对应；
2. 函数的值域需在表长的范围内，计算出的散列地址的分布应均匀，尽可能减少冲突。

下面介绍构造散列函数的几种常用方法。

#### 1. 数字分析法

如果事先知道关键字集合，且每个关键字的位数比散列表的地址码位数多，每个关键字由 \( n \) 位数组成，如 \( k_1 k_2 \cdots k_n \)，则可以从关键字中提取数字分布比较均匀的若干位作为散列地址。例如，有 80 个记录，其关键字为 8 位十进制数。假设散列表的表长为 100，则可取两位十进制数组成散列地址，选取的原则是分析这 80 个关键字，使得到的散列地址尽量避免产生冲突。假设这 80 个关键字中的一部分如下所列：

\[
\begin{array}{cccccccc}
 & 8 & 1 & 3 & 4 & 6 & 5 & 3 & 2 \\
 & 8 & 1 & 3 & 7 & 2 & 2 & 4 & 2 \\
 & 8 & 1 & 3 & 8 & 7 & 4 & 2 & 2 \\
 & 8 & 1 & 3 & 0 & 1 & 3 & 6 & 7 \\
 & 8 & 1 & 3 & 2 & 2 & 8 & 1 & 7 \\
 & 8 & 1 & 3 & 3 & 8 & 9 & 6 & 7 \\
 & 8 & 1 & 3 & 5 & 4 & 1 & 5 & 7 \\
 & 8 & 1 & 3 & 6 & 8 & 5 & 3 & 7 \\
 & 8 & 1 & 4 & 1 & 9 & 3 & 5 & 5 \\
\end{array}
\]

①②③④⑤⑥⑦⑧

从对关键字全体的分析中可以发现：第①、②位都是“8 1”，第③位可能取 3 或 4，第⑧位可能取 2、5 或 7，因此这 4 位都不可取。由于中间的 4 位可看成近乎随机的，因此可取其中任意两位，或取其中两位与另外两位叠加求和后舍去进位作为散列地址。

数字分析法的适用情况：事先必须明确知道所有的关键字每一位上各种数字的分布情况。在实际应用中，例如，同一出版社出版的所有图书，其 ISBN 的前几位都是相同的，因此，若数据表只包含同一出版社的图书，构造散列函数时可以利用数字分析法排除 ISBN 的前几位数字。

#### 2. 平方取中法

通常在选定散列函数时不一定能知道关键字的全部情况，取其中某几位也不一定合适，而一个数平方后的中间几位数和数的每一位都相关，如果取关键字平方后的中间几位或其组合作为散列地址，则使随机分布的关键字得到的散列地址也是随机的，具体所取的位数由表长决定。平方取中法是一种较常用的构造散列函数的方法。

例如，为源程序中的标识符建立一个散列表，假设标识符为字母开头的由字母和数字组成的串。假设人为约定每个标识的内部编码规则如下：把字母在字母表中的位置序号作为该字母的内部编码，如 A 的内部编码为 01，D 的内部编码为 04。数字直接用其自身作为内部编码，如 1 的内部编码为 01，2 的内部编码为 02。根据以上编码规则，可知“IDA1”的内部编码为 09040101，同理可以得到“IDB2”“XID3”和“YID4”的内部编码。之后分别对内部编码进行平方运算，再取出第 7 位到第 9 位作为其相应标识符的散列地址，如表 7.2 所示。

表 7.2 标识符及其散列地址

| 标识符 | 内部编码 | 内部编码的平方 | 散列地址 |
|--------|----------|----------------|----------|
| IDA1   | 09040101 | 081723426090201 | 426      |
| IDB2   | 09040202 | 081725252200804 | 252      |
| XID3   | 24090403 | 580347516702409 | 516      |
| YID4   | 25090404 | 629528372883216 | 372      |

平方取中法的适用情况：不能事先了解关键字的所有情况，或难于直接从关键字中找到取值较分散的几位。

### 扩展讲解

#### 散列函数的构造方法

散列函数是将关键字映射到散列表地址的函数。一个好的散列函数应该满足以下两个原则：
1. **计算简单**：散列函数的计算应该简单快速，以提高查找效率。
2. **分布均匀**：散列函数应该尽可能均匀地将关键字映射到散列表的不同地址，以减少冲突。

#### 1. 数字分析法

数字分析法适用于关键字集合已知且关键字位数较多的情况。通过分析关键字的每一位数字的分布情况，选择分布较为均匀的若干位作为散列地址。

**步骤**：
1. 分析关键字的每一位数字的分布情况。
2. 选择分布较为均匀的若干位作为散列地址。

**示例**：
假设有80个8位十进制数的关键字，散列表长度为100。通过分析发现第①、②、③、⑧位分布不均匀，而中间的4位分布较为均匀，因此可以选择中间的两位作为散列地址。

#### 2. 平方取中法

平方取中法适用于关键字分布未知或难以直接选择分布均匀的位数的情况。通过将关键字平方后取中间几位作为散列地址，使得散列地址的分布更加随机。

**步骤**：
1. 将关键字进行平方运算。
2. 取平方结果的中间几位作为散列地址。

**示例**：
假设标识符的内部编码为字母和数字的组合，将内部编码平方后取中间几位作为散列地址。例如，“IDA1”的内部编码为09040101，平方后取中间几位得到散列地址426。

### 选择题

1. **在构造散列函数时，通常需要考虑以下哪些因素？**
   - A. 散列表的长度
   - B. 关键字的长度
   - C. 关键字的分布情况
   - D. 计算散列函数所需的时间
   - E. 记录的查找频率

   **答案**：A, B, C, D, E
   **解释**：构造散列函数时需要考虑散列表的长度、关键字的长度、关键字的分布情况、计算散列函数所需的时间以及记录的查找频率。

2. **一个好的散列函数应满足以下哪些原则？**
   - A. 函数计算要简单
   - B. 每一关键字只能有一个散列地址与之对应
   - C. 函数的值域需在表长的范围内
   - D. 计算出的散列地址的分布应均匀

   **答案**：A, B, C, D
   **解释**：一个好的散列函数应满足计算简单、每一关键字只能有一个散列地址与之对应、函数的值域需在表长的范围内、计算出的散列地址的分布应均匀。

3. **数字分析法适用于以下哪种情况？**
   - A. 关键字集合已知且关键字位数较多
   - B. 关键字分布未知
   - C. 散列表长度较小
   - D. 关键字位数较少

   **答案**：A
   **解释**：数字分析法适用于关键字集合已知且关键字位数较多的情况。

4. **在数字分析法中，如何选择散列地址？**
   - A. 选择分布较为均匀的若干位
   - B. 选择关键字的前几位
   - C. 选择关键字的后几位
   - D. 随机选择若干位

   **答案**：A
   **解释**：在数字分析法中，选择分布较为均匀的若干位作为散列地址。

5. **平方取中法适用于以下哪种情况？**
   - A. 关键字分布未知
   - B. 关键字位数较少
   - C. 散列表长度较大
   - D. 关键字位数较多

   **答案**：A
   **解释**：平方取中法适用于关键字分布未知的情况。

6. **在平方取中法中，如何计算散列地址？**
   - A. 将关键字进行平方运算，取中间几位
   - B. 将关键字进行平方运算，取前几位
   - C. 将关键字进行平方运算，取后几位
   - D. 将关键字进行平方运算，取随机几位

   **答案**：A
   **解释**：在平方取中法中，将关键字进行平方运算，取中间几位作为散列地址。

7. **假设关键字为8位十进制数，散列表长度为100，使用数字分析法时，应选择几位作为散列地址？**
   - A. 1位
   - B. 2位
   - C. 3位
   - D. 4位

   **答案**：B
   **解释**：假设关键字为8位十进制数，散列表长度为100，使用数字分析法时，应选择2位作为散列地址。

8. **在数字分析法中，如果关键字的某几位分布不均匀，应如何处理？**
   - A. 选择这些位作为散列地址
   - B. 不选择这些位作为散列地址
   - C. 随机选择这些位作为散列地址
   - D. 将这些位进行平方运算

   **答案**：B
   **解释**：在数字分析法中，如果关键字的某几位分布不均匀，不应选择这些位作为散列地址。

9. **在平方取中法中，如果关键字为字母和数字的组合，应如何进行内部编码？**
   - A. 将字母转换为ASCII码
   - B. 将字母在字母表中的位置序号作为内部编码
   - C. 将数字转换为二进制
   - D. 将字母和数字直接拼接

   **答案**：B
   **解释**：在平方取中法中，如果关键字为字母和数字的组合，应将字母在字母表中的位置序号作为内部编码。

10. **在平方取中法中，如果内部编码为09040101，平方后取中间几位作为散列地址，应取几位？**
    - A. 1位
    - B. 2位
    - C. 3位
    - D. 4位

    **答案**：C
    **解释**：在平方取中法中，如果内部编码为09040101，平方后取中间几位作为散列地址，应取3位。

11. **在数字分析法中，如果关键字的某几位分布较为均匀，应如何处理？**
    - A. 选择这些位作为散列地址
    - B. 不选择这些位作为散列地址
    - C. 随机选择这些位作为散列地址
    - D. 将这些位进行平方运算

    **答案**：A
    **解释**：在数字分析法中，如果关键字的某几位分布较为均匀，应选择这些位作为散列地址。

12. **在平方取中法中，如果关键字为8位十进制数，散列表长度为100，应取几位作为散列地址？**
    - A. 1位
    - B. 2位
    - C. 3位
    - D. 4位

    **答案**：C
    **解释**：在平方取中法中，如果关键字为8位十进制数，散列表长度为100，应取3位作为散列地址。

13. **在数字分析法中，如果关键字的某几位分布不均匀，应如何处理？**
    - A. 选择这些位作为散列地址
    - B. 不选择这些位作为散列地址
    - C. 随机选择这些位作为散列地址
    - D. 将这些位进行平方运算

    **答案**：B
    **解释**：在数字分析法中，如果关键字的某几位分布不均匀，不应选择这些位作为散列地址。

14. **在平方取中法中，如果关键字为字母和数字的组合，应如何进行内部编码？**
    - A. 将字母转换为ASCII码
    - B. 将字母在字母表中的位置序号作为内部编码
    - C. 将数字转换为二进制
    - D. 将字母和数字直接拼接

    **答案**：B
    **解释**：在平方取中法中，如果关键字为字母和数字的组合，应将字母在字母表中的位置序号作为内部编码。

15. **在平方取中法中，如果内部编码为09040101，平方后取中间几位作为散列地址，应取几位？**
    - A. 1位
    - B. 2位
    - C. 3位
    - D. 4位

    **答案**：C
    **解释**：在平方取中法中，如果内部编码为09040101，平方后取中间几位作为散列地址，应取3位。

16. **在数字分析法中，如果关键字的某几位分布较为均匀，应如何处理？**
    - A. 选择这些位作为散列地址
    - B. 不选择这些位作为散列地址
    - C. 随机选择这些位作为散列地址
    - D. 将这些位进行平方运算

    **答案**：A
    **解释**：在数字分析法中，如果关键字的某几位分布较为均匀，应选择这些位作为散列地址。

17. **在平方取中法中，如果关键字为8位十进制数，散列表长度为100，应取几位作为散列地址？**
    - A. 1位
    - B. 2位
    - C. 3位
    - D. 4位

    **答案**：C
    **解释**：在平方取中法中，如果关键字为8位十进制数，散列表长度为100，应取3位作为散列地址。

18. **在数字分析法中，如果关键字的某几位分布不均匀，应如何处理？**
    - A. 选择这些位作为散列地址
    - B. 不选择这些位作为散列地址
    - C. 随机选择这些位作为散列地址
    - D. 将这些位进行平方运算

    **答案**：B
    **解释**：在数字分析法中，如果关键字的某几位分布不均匀，不应选择这些位作为散列地址。

19. **在平方取中法中，如果关键字为字母和数字的组合，应如何进行内部编码？**
    - A. 将字母转换为ASCII码
    - B. 将字母在字母表中的位置序号作为内部编码
    - C. 将数字转换为二进制
    - D. 将字母和数字直接拼接

    **答案**：B
    **解释**：在平方取中法中，如果关键字为字母和数字的组合，应将字母在字母表中的位置序号作为内部编码。

20. **在平方取中法中，如果内部编码为09040101，平方后取中间几位作为散列地址，应取几位？**
    - A. 1位
    - B. 2位
    - C. 3位
    - D. 4位

    **答案**：C
    **解释**：在平方取中法中，如果内部编码为09040101，平方后取中间几位作为散列地址，应取3位。